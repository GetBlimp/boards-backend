box: flenter/multi-python
build:
  steps:

    - install-packages:
        packages: postgresql-devel

    - script:
        name: setup virtual environment
        code: |
          sudo pip install virtualenv

    - script:
        name: setup/activate virtualenv using 3.3.3
        code: |
            virtualenv -p /usr/local/bin/python3 /tmp/venv33
            source /tmp/venv33/bin/activate

    - script:
        name: pip install
        code: |
          pip install -r requirements.txt

    - script:
        name: echo python information
        code: |
          echo "python version $(python --version) running"
          echo "pip version $(pip --version) running"

    - script:
        name: test
        code: |
          python manage.py test --pattern=*_tests.py

    - script:
        name: deactivate virtualenv
        code: |
            deactivate

  after-steps:
    - hipchat-notify:
        token: $HIPCHAT_TOKEN
        room-id: $HIPCHAT_ROOM_ID